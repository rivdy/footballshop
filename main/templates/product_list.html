{% extends "base.html" %}
{% load static humanize %}
{% block title %}Products — Garuda Football Shop{% endblock %}

{% block content %}
<div style="max-width:1080px;margin:0 auto;padding:24px 16px;">

  <!-- ===== Header Halaman ===== -->
  <header class="mb-4">
    <h1 class="text-2xl font-semibold m-0">Latest Products</h1>
    <p class="mt-1 opacity-85">Stay updated with the latest sport items and deals.</p>
  </header>

  <!-- ===== Toolbar: Tabs kiri + Last login kanan ===== -->
      <div class="flex items-center justify-between gap-3 border rounded-xl px-4 py-3 mb-4"
        style="border-color:#1e2030;">
      <nav class="flex gap-2 flex-wrap">
        <a href="?filter=all" class="inline-block px-3 py-2 rounded-lg border"
          style="border-color:#1e2030;text-decoration:none;{% if filter_type == 'all' %}outline:2px solid var(--stroke);{% endif %}">
          All Products
        </a>
        <a href="?filter=my" class="inline-block px-3 py-2 rounded-lg border"
          style="border-color:#1e2030;text-decoration:none;{% if filter_type == 'my' %}outline:2px solid var(--stroke);{% endif %}">
          My Products
        </a>
        
      </nav>
    </div>


  <!-- ===== Endpoints untuk JS (WAJIB TUGAS 6) ===== -->
  <div id="endpoints"
       data-list="{% url 'main:products_json' %}"
       data-create="{% url 'main:product_create_ajax' %}"
       data-update-pattern="{% url 'main:product_update_ajax' 0 %}"   {# 0 akan diganti JS dengan ID sebenarnya #}
       data-delete-pattern="{% url 'main:product_delete_ajax' 0 %}"
       data-login="{% url 'main:login_ajax' %}"
       data-register="{% url 'main:register_ajax' %}"
       data-logout="{% url 'main:logout_ajax' %}">
  </div>

  <!-- ===== Tombol aksi list ===== -->
  <div class="flex items-center gap-2 mb-3">
    <button id="btn-refresh" class="btn">↻ Refresh</button>
    <button id="btn-open-create" class="btn btn-primary">+ Create</button>
  </div>

  <!-- ===== State placeholders (Loading/Empty/Error) ===== -->
  <div id="state-loading" class="empty" style="display:none;">Loading...</div>
  <div id="state-error" class="empty" style="display:none;">Terjadi error saat memuat data.</div>
  <div id="state-empty" class="empty" style="display:none;">
    Belum ada product. Klik
    <button class="btn btn-primary" id="btn-open-create-2">+ Create</button>
    untuk menambahkan.
  </div>

  <!-- ===== Container LIST (dirender via JS) ===== -->
  <div id="product-list" class="cards-grid"></div>

  <!-- (Opsional) Fallback noscript kalau JS mati -->
  <noscript>
    <div class="empty">Aktifkan JavaScript untuk melihat daftar produk.</div>
  </noscript>

</div>

<!-- ===== MODALS & TOAST (WAJIB TUGAS 6) ===== -->

<div id="modal-product" class="modal">
  <div class="backdrop"></div>
  <form id="form-product" class="panel" novalidate>
    {% csrf_token %}
    <div class="modal-head">
      <div class="modal-title">Edit Product</div>
      <button type="button" class="modal-close" id="btn-x-close">×</button>
    </div>

    <input type="hidden" name="id" id="f-id">

    <div class="field">
      <label for="f-name">Nama</label>
      <input class="input" type="text" name="name" id="f-name" required>
    </div>

    <div class="field">
      <label for="f-price">Harga</label>
      <input class="input" type="number" name="price" id="f-price" required>
    </div>

    <div class="field">
      <label for="f-category">Kategori</label>
      <input class="input" type="text" name="category" id="f-category">
    </div>

    <div class="field">
      <label for="f-description">Deskripsi</label>
      <textarea class="textarea" name="description" id="f-description"></textarea>
    </div>

    <div class="actions">
      <button type="button" class="btn" id="btn-cancel">Cancel</button>
      <button type="submit" class="btn btn-primary" id="btn-submit">Save</button>
    </div>
  </form>
</div>

{# ===== Modal Delete Confirm (baru) ===== #}
<div id="modal-delete" class="modal">
  <div class="backdrop"></div>
  <div class="panel" style="text-align:center;">
    <div class="modal-head">
      <div class="modal-title">Konfirmasi</div>
      <button type="button" class="modal-close" id="btn-del-x">×</button>
    </div>
    <p>Hapus produk ini?</p>
    <div class="actions" style="justify-content:center;">
      <button class="btn" id="btn-del-cancel">Cancel</button>
      <button class="btn btn-primary" id="btn-del-yes">Delete</button>
    </div>
  </div>
</div>


<!-- Toast container -->
<div id="toast" style="position:fixed;right:16px;bottom:16px;z-index:50;"></div>

<!-- ===== Import JS (sesuai Tutorial 5) ===== -->
<script src="{% static 'main/js/utils.js' %}"></script>
<script src="{% static 'main/js/products.js' %}"></script>
<script src="{% static 'main/js/auth.js' %}"></script>
{% endblock %}
